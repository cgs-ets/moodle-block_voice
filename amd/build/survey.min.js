define(["jquery","core/log","core/ajax"],function(e,n,i){"use strict";function s(t,a){this.instanceid=parseInt(t),this.rootel=a}return s.prototype.main=function(){var a=this;a.rootel.on("change",".answer",function(){var t=e(this);t.is(":checked")&&a.submitAnswer(t)}),a.rootel.find(".questions").removeClass("loading")},s.prototype.submitAnswer=function(t){var a=t.closest("label"),e=t.closest(".question");a.attr("data-status","saving"),e.attr("data-status","saving"),e.find(".answer").attr("disabled",!0);t={instanceid:this.instanceid,questionid:e.data("id"),responsevalue:t.val()};i.call([{methodname:"block_voice_survey_api",args:{action:"submit_answer",data:JSON.stringify(t)},done:function(t){e.find("label").attr("data-status",""),a.attr("data-status","selected"),e.attr("data-status","saved"),e.find(".answer").attr("disabled",!1)},fail:function(t){a.attr("data-status",""),e.attr("data-status","unsaved"),e.find(".answer").attr("disabled",!1),n.debug(t)}}])},s.prototype.generateQuestionCSV=function(){var t=this.rootel.find('input[name="config_questionscsv"]'),a=new Array;this.rootel.find("input.question:checked").each(function(){a.push(e(this).val())}),t.val(a.join())},{init:function(t){n.debug("block_voice/survey: initializing");var a=e(".survey");a.length?new s(t,a).main():n.error("block_voice/survey: rootel '.survey' not found!")}}});