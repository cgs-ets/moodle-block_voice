define(["jquery","core/log","core/ajax"],function(e,s,n){"use strict";function i(t,a){this.instanceid=parseInt(t),this.rootel=a}return i.prototype.main=function(){var a=this;a.rootel.on("change",".answer",function(){var t=e(this);t.is(":checked")&&a.submitAnswer(t)}),a.rootel.find(".questions").removeClass("loading")},i.prototype.submitAnswer=function(t){var a=t.closest("label"),e=t.closest(".question");a.attr("data-status","saving"),e.attr("data-status","saving"),e.find(".answer").attr("disabled",!0);t={instanceid:this.instanceid,questionid:e.data("id"),responsevalue:t.val()};n.call([{methodname:"block_voice_survey_api",args:{action:"submit_answer",data:JSON.stringify(t)},done:function(t){e.find("label").attr("data-status",""),a.attr("data-status","selected"),e.attr("data-status","saved"),e.find(".answer").attr("disabled",!1)},fail:function(t){a.attr("data-status",""),e.attr("data-status","unsaved"),e.find(".answer").attr("disabled",!1),s.debug(t)}}])},{init:function(t){s.debug("block_voice/survey: initializing");var a=e(".survey");a.length?new i(t,a).main():s.error("block_voice/survey: rootel '.survey' not found!")}}});