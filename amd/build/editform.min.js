define(["jquery","core/log","core/ajax"],function(e,t,i){"use strict";function r(n,o){this.instanceid=parseInt(n),this.rootel=o}return r.prototype.main=function(){var o=this;o.rootel.on("change",'select[name="config_survey"]',function(){var n=e(this);o.loadQuestions(n.val())}),o.rootel.on("change","input.question",function(){o.generateQuestionCSV()}),o.rootel.find('select[name="config_survey"]').change()},r.prototype.loadQuestions=function(n){var o=this;n&&(n={instanceid:o.instanceid,surveyid:n},i.call([{methodname:"block_voice_editform_api",args:{action:"get_questions",data:JSON.stringify(n)},done:function(n){o.rootel.find("#questions").html(n)},fail:function(n){t.debug(n)}}]))},r.prototype.generateQuestionCSV=function(){var n=this.rootel.find('input[name="config_questionscsv"]'),o=new Array;this.rootel.find("input.question:checked").each(function(){o.push(e(this).val())}),n.val(o.join())},{init:function(n){t.debug("block_voice/editform: initializing");var o=e(".mform");o.length?new r(n,o).main():t.error("block_voice/editform: rootel '.mform' not found!")}}});