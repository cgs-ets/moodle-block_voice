define(["jquery","core/log","core/ajax"],function(o,t,i){"use strict";function r(n,e){this.instanceid=parseInt(n),this.rootel=e}return r.prototype.main=function(){var e=this;e.rootel.on("change",'select[name="config_survey"]',function(){var n=o(this);e.loadQuestions(n.val())}),e.rootel.find('select[name="config_survey"]').change(),e.rootel.on("change","input.question",function(){e.generateQuestionCSV()})},r.prototype.loadQuestions=function(n){var e=this;n&&(n={instanceid:e.instanceid,surveyid:n},i.call([{methodname:"block_voice_editform_api",args:{action:"get_questions",data:JSON.stringify(n)},done:function(n){e.rootel.find("#questions").html(n),e.generateQuestionCSV()},fail:function(n){t.debug(n)}}]))},r.prototype.generateQuestionCSV=function(){var n=this.rootel.find('input[name="config_questionscsv"]'),e=new Array;this.rootel.find("input.question:checked").each(function(){e.push(o(this).val())}),n.val(e.join())},{init:function(n){t.debug("block_voice/editform: initializing");var e=o(".mform");e.length?new r(n,e).main():t.error("block_voice/editform: rootel '.mform' not found!")}}});