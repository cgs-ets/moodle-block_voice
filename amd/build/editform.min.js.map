{"version":3,"sources":["../src/editform.js"],"names":["define","$","Log","Ajax","EditForm","instanceid","rootel","self","parseInt","prototype","main","on","select","loadQuestions","val","generateQuestionCSV","find","change","surveyid","data","call","methodname","args","action","JSON","stringify","done","html","fail","reason","debug","input","questions","each","push","join","init","length","error","editform"],"mappings":"AA2BCA,OAAM,wBAAC,CAAC,QAAD,CAAW,UAAX,CAAuB,WAAvB,CAAD,CACH,SAASC,CAAT,CAAYC,CAAZ,CAAiBC,CAAjB,CAAuB,CACvB,aA0BA,QAASC,CAAAA,CAAT,CAAkBC,CAAlB,CAA8BC,CAA9B,CAAsC,CAClC,GAAIC,CAAAA,CAAI,CAAG,IAAX,CACAA,CAAI,CAACF,UAAL,CAAkBG,QAAQ,CAACH,CAAD,CAA1B,CACAE,CAAI,CAACD,MAAL,CAAcA,CACjB,CAMAF,CAAQ,CAACK,SAAT,CAAmBC,IAAnB,CAA0B,UAAY,CACnC,GAAIH,CAAAA,CAAI,CAAG,IAAX,CAGAA,CAAI,CAACD,MAAL,CAAYK,EAAZ,CAAe,QAAf,CAAyB,gCAAzB,CAAyD,UAAW,CAChE,GAAIC,CAAAA,CAAM,CAAGX,CAAC,CAAC,IAAD,CAAd,CACAM,CAAI,CAACM,aAAL,CAAmBD,CAAM,CAACE,GAAP,EAAnB,CACH,CAHD,EAMAP,CAAI,CAACD,MAAL,CAAYK,EAAZ,CAAe,QAAf,CAAyB,gBAAzB,CAA2C,UAAY,CACnDJ,CAAI,CAACQ,mBAAL,EACH,CAFD,EAKAR,CAAI,CAACD,MAAL,CAAYU,IAAZ,CAAiB,gCAAjB,EAAiDC,MAAjD,EAEH,CAjBA,CAmBDb,CAAQ,CAACK,SAAT,CAAmBI,aAAnB,CAAmC,SAAUK,CAAV,CAAoB,CACnD,GAAIX,CAAAA,CAAI,CAAG,IAAX,CAEA,GAAIW,CAAJ,CAAc,CACV,GAAIC,CAAAA,CAAI,CAAG,CACP,WAAcZ,CAAI,CAACF,UADZ,CAEP,SAAYa,CAFL,CAAX,CAIAf,CAAI,CAACiB,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,0BADL,CAEPC,IAAI,CAAE,CACFC,MAAM,CAAE,eADN,CAEFJ,IAAI,CAAEK,IAAI,CAACC,SAAL,CAAeN,CAAf,CAFJ,CAFC,CAMPO,IAAI,CAAE,cAASC,CAAT,CAAe,CACjBpB,CAAI,CAACD,MAAL,CAAYU,IAAZ,CAAiB,YAAjB,EAA+BW,IAA/B,CAAoCA,CAApC,CACH,CARM,CASPC,IAAI,CAAE,cAASC,CAAT,CAAiB,CACnB3B,CAAG,CAAC4B,KAAJ,CAAUD,CAAV,CACH,CAXM,CAAD,CAAV,CAaH,CACJ,CAtBD,CAwBAzB,CAAQ,CAACK,SAAT,CAAmBM,mBAAnB,CAAyC,UAAY,IAC7CR,CAAAA,CAAI,CAAG,IADsC,CAG7CwB,CAAK,CAAGxB,CAAI,CAACD,MAAL,CAAYU,IAAZ,CAAiB,qCAAjB,CAHqC,CAM7CgB,CAAS,GANoC,CAOjDzB,CAAI,CAACD,MAAL,CAAYU,IAAZ,CAAiB,wBAAjB,EAA2CiB,IAA3C,CAAgD,UAAU,CACtDD,CAAS,CAACE,IAAV,CAAejC,CAAC,CAAC,IAAD,CAAD,CAAQa,GAAR,EAAf,CACH,CAFD,EAMAiB,CAAK,CAACjB,GAAN,CAAUkB,CAAS,CAACG,IAAV,EAAV,CACH,CAdD,CAgBA,MAAO,CACHC,IAAI,CA3FR,SAAc/B,CAAd,CAA0B,CACtBH,CAAG,CAAC4B,KAAJ,CAAU,oCAAV,EAEA,GAAIxB,CAAAA,CAAM,CAAGL,CAAC,CAAC,QAAD,CAAd,CAEA,GAAI,CAACK,CAAM,CAAC+B,MAAZ,CAAoB,CAChBnC,CAAG,CAACoC,KAAJ,CAAU,kDAAV,EACA,MACH,CAED,GAAIC,CAAAA,CAAQ,CAAG,GAAInC,CAAAA,CAAJ,CAAaC,CAAb,CAAyBC,CAAzB,CAAf,CACAiC,CAAQ,CAAC7B,IAAT,EACH,CA8EM,CAGV,CApGM,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Provides the block_voice/editform module\r\n *\r\n * @package   block_voice\r\n * @category  output\r\n * @copyright 2021 Michael Vangelovski\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\n/**\r\n * @module block_voice/editform\r\n */\r\n define(['jquery', 'core/log', 'core/ajax'], \r\n    function($, Log, Ajax) {    \r\n    'use strict';\r\n\r\n    /**\r\n     * Initializes the editform component.\r\n     */\r\n    function init(instanceid) {\r\n        Log.debug('block_voice/editform: initializing');\r\n\r\n        var rootel = $('.mform');\r\n\r\n        if (!rootel.length) {\r\n            Log.error('block_voice/editform: rootel \\'.mform\\' not found!');\r\n            return;\r\n        }\r\n\r\n        var editform = new EditForm(instanceid, rootel);\r\n        editform.main();\r\n    }\r\n\r\n    /**\r\n     * The constructor\r\n     *\r\n     * @constructor\r\n     * @param int rootel\r\n     * @param {jQuery} rootel\r\n     */\r\n    function EditForm(instanceid, rootel) {\r\n        var self = this;\r\n        self.instanceid = parseInt(instanceid);\r\n        self.rootel = rootel;\r\n    }\r\n\r\n    /**\r\n     * Run the editform js.\r\n     *\r\n     */\r\n     EditForm.prototype.main = function () {\r\n        var self = this;\r\n\r\n        // Load questions on survey selection\r\n        self.rootel.on('change', 'select[name=\"config_survey\"]', function() {\r\n            var select = $(this);\r\n            self.loadQuestions(select.val());\r\n        });\r\n\r\n        // Select a question checkbox.\r\n        self.rootel.on('change', 'input.question', function () {\r\n            self.generateQuestionCSV();\r\n        });\r\n\r\n        //Initial load.\r\n        self.rootel.find('select[name=\"config_survey\"]').change();\r\n\r\n    };\r\n\r\n    EditForm.prototype.loadQuestions = function (surveyid) {\r\n        var self = this;\r\n\r\n        if (surveyid) {\r\n            var data = {\r\n                'instanceid': self.instanceid,\r\n                'surveyid': surveyid,\r\n            };\r\n            Ajax.call([{\r\n                methodname: 'block_voice_editform_api',\r\n                args: { \r\n                    action: 'get_questions',\r\n                    data: JSON.stringify(data),\r\n                },\r\n                done: function(html) {\r\n                    self.rootel.find('#questions').html(html);\r\n                },\r\n                fail: function(reason) {\r\n                    Log.debug(reason);\r\n                }\r\n            }]);\r\n        }\r\n    };\r\n\r\n    EditForm.prototype.generateQuestionCSV = function () {\r\n        var self = this;\r\n\r\n        var input = self.rootel.find('input[name=\"config_questionscsv\"]');\r\n\r\n        // Convert csv into array.\r\n        var questions = new Array();\r\n        self.rootel.find('input.question:checked').each(function(){\r\n            questions.push($(this).val());\r\n        });\r\n            \r\n\r\n        // Update hidden input.\r\n        input.val(questions.join());\r\n    };\r\n\r\n    return {\r\n        init: init\r\n    };\r\n});"],"file":"editform.min.js"}